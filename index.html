<!DOCTYPE html>
<html>

<head>
  <title> ax-cpt with audio files</title>
  <script src="jspsych-6.3.1/jspsych.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-html-button-response.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-audio-button-response.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-preload.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-survey-html-form.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-survey-multi-choice.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-audio-keyboard-response.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-instructions.js"></script>

  <link href="jspsych-6.3.1/css/jspsych.css" rel="stylesheet" type="text/css">
</head>

<body> </body>
<script>

  var timeline = [];

  // instructions
  // keep instructions 1?
  var instructions_1 = {
    type: 'html-button-response',
    stimulus: '<div style="width: 800px;">' +
      '<p>This experiment will test your ability to hold information in short-term, temporary memory. This is called working memory.</p>' +
      '</div>',
    choices: ["Continue"]
  }
  timeline.push(instructions_1);

  var instructions_2 = {
    type: 'html-button-response',
    stimulus: '<div style="width: 800px;">' +
      '<p>You will hear different audio files which all have the same structure: X bla Y bla Z. When you hear "XYZ", that is your target and you are asked to click on "Match". For every other stimulus, you click on "Mismatch". </p>' +
      '</div>',
    choices: ["Continue"]
  }
  timeline.push(instructions_2);

  var instructions_before = {
    type: 'html-button-response',
    stimulus: '<div style="width: 800px;">' +
      '<p> Before we begin with the actual task, we ask you to let us know about your age and gender. </p>' +
      '</div>',
    choices: ["Continue"]
  }
  timeline.push(instructions_before);

  /* Demograpics */
 // move id closer to the start so we can give participants an id?

var id = {
  type: 'survey-html-form',
  preamble: '<p> ID </p>',
  html: '<input type = "text"/>'
}
  timeline.push(id);

var age = {
  type: 'survey-html-form',
  preamble: '<p> Please indicate your age. </p>',
  html: '<input type = "text"/>'
}
timeline.push(age);

var gender_options = ["Female", "Male", "Diverse", "Prefer not to say"];

var gender = {
    type: 'survey-multi-choice',
    questions: [
      {prompt: '<p> Which gender do you identify with? </p>', options: gender_options, required: true}
    ],
  }
  timeline.push(gender);

  var instructions_3 = {
    type: 'html-button-response',
    stimulus: '<div style="width: 800px;">' +
      '<p>The audio will start playing on the next screen.</p>' +
      '<p>Remember: press "M" if the audio is "XYZ", "Q" if it is any other audio .</p>' +
      '</div>',
    choices: ["I'm ready to start!"],
    post_trial_gap: 1000
  }
  timeline.push(instructions_3);


  //var timeline = [];

  var preload = {
    type: 'preload',
    audio: ['crm_sentences/audio/bad/baronRed4.opus', 'crm_sentences/audio/bad/baronRed1.opus', 'crm_sentences/audio/bad/baronRed2.opus', 'crm_sentences/audio/bad/baronRed3.opus',
            'crm_sentences/audio/bad/charlieRed4.opus', 'crm_sentences/audio/bad/charlieRed1.opus', 'crm_sentences/audio/bad/charlieRed2.opus', 'crm_sentences/audio/bad/charlieRed3.opus',
           'crm_sentences/audio/bad/tigerRed1.opus', 'crm_sentences/audio/bad/tigerRed2.opus', 'crm_sentences/audio/bad/tigerRed3.opus', 'crm_sentences/audio/bad/tigerRed4.opus',
           'crm_sentences/audio/bad/eagleRed1.opus', 'crm_sentences/audio/bad/eagleRed2.opus', 'crm_sentences/audio/bad/eagleRed3.opus', 'crm_sentences/audio/bad/eagleRed4.opus'],



    on_success: function (file) {
      console.log('File loaded: ', file);
    },
    on_error: function (file) {
      console.log('Error loading file: ', file);
    }
  };


  timeline.push(preload)

  /* Test Trials */
  // degradation_level: 0 = full, 1 = good, 2 = intermediate, 3 = bad; format: 0 = AX, 1 = AY, 2 = BX, 3 = BY
  var test_stimuli = [
    { stimulus: "crm_sentences/audio/bad/baronRed1.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/baronRed2.opus", degradation_level: 3, format: 1 },
    { stimulus: "crm_sentences/audio/bad/baronRed3.opus", degradation_level: 3, format: 2 },
    { stimulus: "crm_sentences/audio/bad/baronRed4.opus", degradation_level: 3, format: 0 },
   { stimulus: "crm_sentences/audio/bad/charlieRed1.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/charlieRed2.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/charlieRed3.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/charlieRed4.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/tigerRed1.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/tigerRed2.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/tigerRed3.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/tigerRed4.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/eagleRed1.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/eagleRed2.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/eagleRed3.opus", degradation_level: 3, format: 0 },
    { stimulus: "crm_sentences/audio/bad/eagleRed4.opus", degradation_level: 3, format: 0 },

  ];

  /* attempt to add a variable with degraded quality */
  //var test_stimuli_deg = [
  //  {stimulus: "charlieRed1.wav", correct_response: 'f'},
  //  {stimulus: "charlieRed7.wav", correct_response: 'j'}
  //  ];

  /* further attempt */
  //var myArray =  [test_stimuli, test_stimuli_deg]
  //var shuffledArray = [jsPsych.randomization.repeat(myArray, 2)]

  var fixation = {
    type: 'html-keyboard-response',
    stimulus: '<div style="font-size:60px;">+</div>',
    choices: jsPsych.NO_KEYS,
    trial_duration: 1000,
    data: {
      task: 'fixation'
    }
  }

  var test = {
    type: 'audio-keyboard-response',
    stimulus: jsPsych.timelineVariable('stimulus'),
    choices: ['m', 'q'],
    prompt: "<p>Does the audio match the target?</p>",
    data: {
      task: 'response',
      degradation_level: jsPsych.timelineVariable('degradation_level'),
      format: jsPsych.timelineVariable('format')
    }
  };


  var test_procedure = {
    timeline: [fixation, test],
    timeline_variables: test_stimuli,
    repetitions: 5,
    randomize_order: true
  }
  timeline.push(test_procedure)

  var goodbye = {
    type: 'html-button-response',
    stimulus: '<div style="width: 800px;">' +
      '<p> The experiment is over. Thank you for your participation! :) </p>' +
      '</div>',
    choices: ["End"]
  }
  timeline.push(goodbye);
  /* start the experiment */
  jsPsych.init({
    timeline: timeline,
    on_finish: function () {
      jsPsych.data.displayData();
    }
  });

</script>

</html>
