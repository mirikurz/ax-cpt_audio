<!DOCTYPE html>
<html>

<head>
  <title> ax-cpt with audio files</title>
  <script src="jspsych-6.3.1/jspsych.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-html-button-response.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-audio-button-response.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-preload.js"></script>
  <link href="jspsych-6.3.1/css/jspsych.css" rel="stylesheet" type="text/css">
</head>

<body> </body>
<script>

  var timeline = [];

  // instructions
  // keep instructions 1?
  var instructions_1 = {
    type: 'html-button-response',
    stimulus: '<div style="width: 800px;">' +
      '<p>This experiment will test your ability to hold information in short-term, temporary memory. This is called working memory.</p>' +
      '</div>',
    choices: ["Continue"]
  }
  timeline.push(instructions_1);

  var instructions_2 = {
    type: 'html-button-response',
    stimulus: '<div style="width: 800px;">' +
      '<p>You will hear different audio files which all have the same structure: X bla Y bla Z. When you hear "XYZ", that is your target and you are asked to click on "Match". For every other stimulus, you click on "Mismatch". </p>' +
      '</div>',
    choices: ["Continue"]
  }
  timeline.push(instructions_2);

  var instructions_3 = {
    type: 'html-button-response',
    stimulus: '<div style="width: 800px;">' +
      '<p>The audio will start playing on the next screen.</p>' +
      '<p>Remember: press "Match" if the audio is "XYZ" .</p>' +
      '</div>',
    choices: ["I'm ready to start!"],
    post_trial_gap: 1000
  }
  timeline.push(instructions_3);



  //var timeline = [];

  var preload = {
    type: 'preload',
    audio: ['crm_sentences/audio/bad/baronRed4.opus', 'crm_sentences/audio/bad/baronRed1.opus', 'crm_sentences/audio/bad/charlieRed4.opus', 'crm_sentences/audio/bad/charlieRed1.opus'],
    on_success: function (file) {
      console.log('File loaded: ', file);
    },
    on_error: function (file) {
      console.log('Error loading file: ', file);
    }
  };


  timeline.push(preload)

  /* Test Trials */
  var test_stimuli = [
    { stimulus: "baronRed4.opus", degradation_level: 0, format: 0 },
    { stimulus: "baronRed1.opus", degradation_level: 0, format: 1 },
    { stimulus: "charlieRed1.opus", degradation_level: 1, format: 2 },
    { stimulus: "charlieRed4.opus", degradation_level: 1, format: 0 }
  ];

  /* attempt to add a variable with degraded quality */
  //var test_stimuli_deg = [
  //  {stimulus: "charlieRed1.wav", correct_response: 'f'},
  //  {stimulus: "charlieRed7.wav", correct_response: 'j'}
  //  ];

  /* further attempt */
  //var myArray =  [test_stimuli, test_stimuli_deg]
  //var shuffledArray = [jsPsych.randomization.repeat(myArray, 2)]

  var fixation = {
    type: 'html-keyboard-response',
    stimulus: '<div style="font-size:60px;">+</div>',
    choices: jsPsych.NO_KEYS,
    trial_duration: function () {
      return jsPsych.randomization.sampleWithoutReplacement([250, 500, 750, 1000, 1250, 1500, 1750, 2000], 1)[0];
    },
    data: {
      task: 'fixation'
    }
  }

  var test = {
    type: 'audio-button-response',
    stimulus: jsPsych.timelineVariable('stimulus'),
    choices: ['Match', 'Mismatch'],
    prompt: "<p>Does the audio match the target?</p>",
    data: {
      task: 'response',
      degradation_level: jsPsych.timelineVariable('degradation_level'), 
      format: jsPsych.timelineVariable('format')
    }
  };


  var test_procedure = {
    timeline: [fixation, test],
    timeline_variables: test_stimuli,
    repetitions: 5,
    randomize_order: true
  }
  timeline.push(test_procedure)


  /* start the experiment */
  jsPsych.init({
    timeline: timeline,
    on_finish: function () {
      jsPsych.data.displayData();
    }
  });

</script>

</html>
